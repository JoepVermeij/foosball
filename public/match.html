<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Match - Foosball Rating System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Record Match</h1>
        
        <!-- Navigation Menu -->
        <nav class="bg-white shadow-md rounded-lg p-4 mb-8">
            <ul class="flex space-x-4">
                <li><a href="/" class="text-gray-600 hover:text-gray-900">Home</a></li>
                <li><a href="/match" class="text-blue-600 font-semibold">Record Match</a></li>
                <li><a href="/users" class="text-gray-600 hover:text-gray-900">Players</a></li>
                <li><a href="/history" class="text-gray-600 hover:text-gray-900">History</a></li>
            </ul>
        </nav>

        <!-- Match Form -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <form id="matchForm" class="space-y-6">
                <!-- Team 1 -->
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-gray-800">Team 1</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="team1Defender" class="block text-sm font-medium text-gray-700">Defender</label>
                            <select id="team1Defender" name="team1Defender" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="">Select Defender</option>
                            </select>
                        </div>
                        <div>
                            <label for="team1Attacker" class="block text-sm font-medium text-gray-700">Attacker</label>
                            <select id="team1Attacker" name="team1Attacker" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="">Select Attacker</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Team 2 -->
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-gray-800">Team 2</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="team2Defender" class="block text-sm font-medium text-gray-700">Defender</label>
                            <select id="team2Defender" name="team2Defender" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="">Select Defender</option>
                            </select>
                        </div>
                        <div>
                            <label for="team2Attacker" class="block text-sm font-medium text-gray-700">Attacker</label>
                            <select id="team2Attacker" name="team2Attacker" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="">Select Attacker</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Winner Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Winner</label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="winner" value="1" required
                                   class="form-radio text-blue-600">
                            <span class="ml-2">Team 1</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="winner" value="2" required
                                   class="form-radio text-blue-600">
                            <span class="ml-2">Team 2</span>
                        </label>
                    </div>
                </div>

                <button type="submit" 
                        class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Record Match
                </button>
            </form>
        </div>
    </div>

    <script>
        // Fetch and populate player lists
        async function fetchPlayers() {
            try {
                const [defendersResponse, attackersResponse] = await Promise.all([
                    fetch('/api/players/defender'),
                    fetch('/api/players/attacker')
                ]);

                if (!defendersResponse.ok || !attackersResponse.ok) {
                    throw new Error('Failed to fetch players');
                }

                const defenders = await defendersResponse.json();
                const attackers = await attackersResponse.json();

                // Populate defender dropdowns
                const defenderOptions = defenders.map(player => 
                    `<option value="${player.name}">${player.name} (${player.rating.toFixed(2)})</option>`
                ).join('');
                
                document.getElementById('team1Defender').innerHTML += defenderOptions;
                document.getElementById('team2Defender').innerHTML += defenderOptions;

                // Populate attacker dropdowns
                const attackerOptions = attackers.map(player => 
                    `<option value="${player.name}">${player.name} (${player.rating.toFixed(2)})</option>`
                ).join('');
                
                document.getElementById('team1Attacker').innerHTML += attackerOptions;
                document.getElementById('team2Attacker').innerHTML += attackerOptions;
            } catch (error) {
                console.error('Error fetching players:', error);
                alert('Failed to fetch players');
            }
        }

        // Handle form submission
        document.getElementById('matchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const matchData = {
                team1: {
                    defender: formData.get('team1Defender'),
                    attacker: formData.get('team1Attacker')
                },
                team2: {
                    defender: formData.get('team2Defender'),
                    attacker: formData.get('team2Attacker')
                },
                winner: parseInt(formData.get('winner'))
            };

            try {
                const response = await fetch('/api/match', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(matchData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to record match');
                }

                // Reset form
                e.target.reset();
                alert('Match recorded successfully!');
            } catch (error) {
                console.error('Error recording match:', error);
                alert(error.message);
            }
        });

        // Initial load
        fetchPlayers();
    </script>
</body>
</html> 